language: node_js
node_js:
  - '17'
cache: yarn
install:
  - yarn install
jobs:
  include:
    - stage: npm release
      # only release on master branch with specific commit message (generated by npm version)
      if: branch = master
      before_deploy:
        - yarn build
        - cp ./package.json ./lib/
        - npm config set registry https://registry.npmjs.org/
      deploy:
        edge: true
        access: public
        src: './lib'
        provider: npm
        email: '$NPM_EMAIL'
        api_token: '$NPM_TOKEN'
        cleanup: false
